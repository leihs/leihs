<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: makefont.rb</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>makefont.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>vendor/plugins/active_fpdf/lib/makefont.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Thu Jun 05 12:49:06 +0200 2008</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Utility to generate font definition files Version: 1.1 Date: 2006-07-19
</p>
<p>
Changelog:
</p>
<pre>
 Version 1.1 - Brian Ollenberger
  - Fixed a very small bug in MakeFont for generating FontDef.diff.
</pre>

    </div>

    <div id="requires-list">
      <h3 class="section-bar">Required files</h3>

      <div class="name-list">
      zlib&nbsp;&nbsp;
      </div>
    </div>

   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000007">CheckTTF</a>&nbsp;&nbsp;
      <a href="#M000008">MakeFont</a>&nbsp;&nbsp;
      <a href="#M000002">MakeFontDescriptor</a>&nbsp;&nbsp;
      <a href="#M000004">MakeFontEncoding</a>&nbsp;&nbsp;
      <a href="#M000003">MakeWidthArray</a>&nbsp;&nbsp;
      <a href="#M000001">ReadAFM</a>&nbsp;&nbsp;
      <a href="#M000006">ReadLong</a>&nbsp;&nbsp;
      <a href="#M000005">ReadShort</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Charencodings</td>
          <td>=</td>
          <td class="context-item-value">{ # Central Europe     'cp1250' =&gt; [         '.notdef',        '.notdef',        '.notdef',        '.notdef',         '.notdef',        '.notdef',        '.notdef',        '.notdef',         '.notdef',        '.notdef',        '.notdef',        '.notdef',         '.notdef',        '.notdef',        '.notdef',        '.notdef',         '.notdef',        '.notdef',        '.notdef',        '.notdef',         '.notdef',        '.notdef',        '.notdef',        '.notdef',         '.notdef',        '.notdef',        '.notdef',        '.notdef',         '.notdef',        '.notdef',        '.notdef',        '.notdef',         'space',          'exclam',         'quotedbl',       'numbersign',         'dollar',         'percent',        'ampersand',      'quotesingle',         'parenleft',      'parenright',     'asterisk',       'plus',         'comma',          'hyphen',         'period',         'slash',         'zero',           'one',            'two',            'three',         'four',           'five',           'six',            'seven',         'eight',          'nine',           'colon',          'semicolon',         'less',           'equal',          'greater',        'question',         'at',             'A',              'B',              'C',         'D',              'E',              'F',              'G',         'H',              'I',              'J',              'K',         'L',              'M',              'N',              'O',         'P',              'Q',              'R',              'S',         'T',              'U',              'V',              'W',         'X',              'Y',              'Z',              'bracketleft',         'backslash',      'bracketright',   'asciicircum',    'underscore',         'grave',          'a',              'b',              'c',         'd',              'e',              'f',              'g',         'h',              'i',              'j',              'k',         'l',              'm',              'n',              'o',         'p',              'q',              'r',              's',         't',              'u',              'v',              'w',         'x',              'y',              'z',              'braceleft',         'bar',            'braceright',     'asciitilde',     '.notdef',         'Euro',           '.notdef',        'quotesinglbase', '.notdef',         'quotedblbase',   'ellipsis',       'dagger',         'daggerdbl',         '.notdef',        'perthousand',    'Scaron',         'guilsinglleft',         'Sacute',         'Tcaron',         'Zcaron',         'Zacute',         '.notdef',        'quoteleft',      'quoteright',     'quotedblleft',         'quotedblright',  'bullet',         'endash',         'emdash',         '.notdef',        'trademark',      'scaron',         'guilsinglright',         'sacute',         'tcaron',         'zcaron',         'zacute',         'space',          'caron',          'breve',          'Lslash',         'currency',       'Aogonek',        'brokenbar',      'section',         'dieresis',       'copyright',      'Scedilla',       'guillemotleft',         'logicalnot',     'hyphen',         'registered',     'Zdotaccent',         'degree',         'plusminus',      'ogonek',         'lslash',         'acute',          'mu',             'paragraph',      'periodcentered',         'cedilla',        'aogonek',        'scedilla',       'guillemotright',         'Lcaron',         'hungarumlaut',   'lcaron',         'zdotaccent',         'Racute',         'Aacute',         'Acircumflex',    'Abreve',         'Adieresis',      'Lacute',         'Cacute',         'Ccedilla',         'Ccaron',         'Eacute',         'Eogonek',        'Edieresis',         'Ecaron',         'Iacute',         'Icircumflex',    'Dcaron',         'Dcroat',         'Nacute',         'Ncaron',         'Oacute',         'Ocircumflex',    'Ohungarumlaut',  'Odieresis',      'multiply',         'Rcaron',         'Uring',          'Uacute',         'Uhungarumlaut',         'Udieresis',      'Yacute',         'Tcommaaccent',   'germandbls',         'racute',         'aacute',         'acircumflex',    'abreve',         'adieresis',      'lacute',         'cacute',         'ccedilla',         'ccaron',         'eacute',         'eogonek',        'edieresis',         'ecaron',         'iacute',         'icircumflex',    'dcaron',         'dcroat',         'nacute',         'ncaron',         'oacute',         'ocircumflex',    'ohungarumlaut',  'odieresis',      'divide',         'rcaron',         'uring',          'uacute',         'uhungarumlaut',         'udieresis',      'yacute',         'tcommaaccent',   'dotaccent'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Utility to generate font definition files Version: 1.1 Date: 2006-07-19

<p>
Changelog:
</p>
<pre>
 Version 1.1 - Brian Ollenberger
  - Fixed a very small bug in MakeFont for generating FontDef.diff.
</pre>
</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">CheckTTF</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1590</span>
1590: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">CheckTTF</span>(<span class="ruby-identifier">file</span>)
1591: 
1592:     <span class="ruby-identifier">rl</span> = <span class="ruby-keyword kw">false</span>
1593:     <span class="ruby-identifier">pp</span> = <span class="ruby-keyword kw">false</span>
1594:     <span class="ruby-identifier">e</span>  = <span class="ruby-keyword kw">false</span>
1595: 
1596:     <span class="ruby-comment cmt"># Check if font license allows embedding</span>
1597:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">'rb'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
1598: 
1599:         <span class="ruby-comment cmt"># Extract number of tables</span>
1600:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">4</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
1601:         <span class="ruby-identifier">nb</span> = <span class="ruby-constant">ReadShort</span>(<span class="ruby-identifier">f</span>)
1602:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">6</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
1603: 
1604:         <span class="ruby-comment cmt"># Seek OS/2 table</span>
1605:         <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">false</span>
1606:         <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-identifier">nb</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
1607:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">4</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">'OS/2'</span> <span class="ruby-keyword kw">then</span>
1608:                 <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">true</span>
1609:                 <span class="ruby-keyword kw">break</span>
1610:             <span class="ruby-keyword kw">end</span>
1611: 
1612:            <span class="ruby-identifier">f</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">12</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
1613:         <span class="ruby-keyword kw">end</span>
1614: 
1615:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">found</span> <span class="ruby-keyword kw">then</span>
1616:             <span class="ruby-keyword kw">return</span>
1617:         <span class="ruby-keyword kw">end</span>
1618: 
1619:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">4</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
1620:         <span class="ruby-identifier">offset</span> = <span class="ruby-constant">ReadLong</span>(<span class="ruby-identifier">f</span>)
1621:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_SET</span>)
1622: 
1623:         <span class="ruby-comment cmt"># Extract fsType flags</span>
1624:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">8</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
1625:         <span class="ruby-identifier">fsType</span> = <span class="ruby-constant">ReadShort</span>(<span class="ruby-identifier">f</span>)
1626: 
1627:         <span class="ruby-identifier">rl</span> = (<span class="ruby-identifier">fsType</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x02</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
1628:         <span class="ruby-identifier">pp</span> = (<span class="ruby-identifier">fsType</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x04</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
1629:         <span class="ruby-identifier">e</span>  = (<span class="ruby-identifier">fsType</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x08</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
1630:     <span class="ruby-keyword kw">end</span>
1631: 
1632:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rl</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-operator">!</span> <span class="ruby-identifier">pp</span>) <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-operator">!</span> <span class="ruby-identifier">e</span>) <span class="ruby-keyword kw">then</span>
1633:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">'Warning: font license does not allow embedding'</span>
1634:     <span class="ruby-keyword kw">end</span>
1635: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">MakeFont</span><span class="method-args">(fontfile, afmfile, enc = 'cp1252', patch = {}, type = 'TrueType')</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
fontfile: path to TTF file (or empty string if not to be embedded) afmfile:
path to AFM file enc: font encoding (or empty string for symbolic fonts)
patch: optional patch for encoding type : font type if $fontfile is empty
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1644</span>
1644: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">MakeFont</span>(<span class="ruby-identifier">fontfile</span>, <span class="ruby-identifier">afmfile</span>, <span class="ruby-identifier">enc</span> = <span class="ruby-value str">'cp1252'</span>, <span class="ruby-identifier">patch</span> = {}, <span class="ruby-identifier">type</span> = <span class="ruby-value str">'TrueType'</span>)
1645:     <span class="ruby-comment cmt"># Generate a font definition file</span>
1646:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">enc</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">enc</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">then</span>
1647:         <span class="ruby-identifier">map</span> = <span class="ruby-constant">Charencodings</span>[<span class="ruby-identifier">enc</span>]
1648:         <span class="ruby-identifier">patch</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cc</span>, <span class="ruby-identifier">gn</span><span class="ruby-operator">|</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">cc</span>] = <span class="ruby-identifier">gn</span> }
1649:     <span class="ruby-keyword kw">else</span>
1650:         <span class="ruby-identifier">map</span> = []
1651:     <span class="ruby-keyword kw">end</span>
1652: 
1653:     <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error: AFM file not found: #{afmfile}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">afmfile</span>)
1654: 
1655:     <span class="ruby-identifier">fm</span> = <span class="ruby-constant">ReadAFM</span>(<span class="ruby-identifier">afmfile</span>, <span class="ruby-identifier">map</span>)
1656: 
1657:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">enc</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">enc</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">then</span>
1658:         <span class="ruby-identifier">diff</span> = <span class="ruby-constant">MakeFontEncoding</span>(<span class="ruby-identifier">map</span>)
1659:     <span class="ruby-keyword kw">else</span>
1660:         <span class="ruby-identifier">diff</span> = <span class="ruby-value str">''</span>
1661:     <span class="ruby-keyword kw">end</span>
1662: 
1663:     <span class="ruby-identifier">fd</span> = <span class="ruby-constant">MakeFontDescriptor</span>(<span class="ruby-identifier">fm</span>, (<span class="ruby-identifier">map</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>))
1664: 
1665:     <span class="ruby-comment cmt"># Find font type</span>
1666:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fontfile</span> <span class="ruby-keyword kw">then</span>
1667:         <span class="ruby-identifier">ext</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">fontfile</span>).<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^\./</span>, <span class="ruby-value str">''</span>)
1668: 
1669:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ext</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ttf'</span> <span class="ruby-keyword kw">then</span>
1670:             <span class="ruby-identifier">type</span> = <span class="ruby-value str">'TrueType'</span>
1671:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">ext</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'pfb'</span>
1672:             <span class="ruby-identifier">type</span> = <span class="ruby-value str">'Type1'</span>
1673:         <span class="ruby-keyword kw">else</span>
1674:             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error: unrecognized font file extension: #{ext}&quot;</span>
1675:         <span class="ruby-keyword kw">end</span>
1676:     <span class="ruby-keyword kw">else</span>
1677:             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error: incorrect font type: #{type}&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'TrueType'</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'Type1'</span>)
1678:     <span class="ruby-keyword kw">end</span>
1679:     <span class="ruby-identifier">printf</span> <span class="ruby-node">&quot;type = #{type}\n&quot;</span>
1680:     <span class="ruby-comment cmt"># Start generation</span>
1681:     <span class="ruby-identifier">s</span>  = <span class="ruby-node">&quot;# #{fm['FontName']} font definition\n\n&quot;</span>
1682:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;module FontDef\n&quot;</span>
1683:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.type\n        '#{type}'\n    end\n&quot;</span>
1684:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.name\n        '#{fm['FontName']}'\n    end\n&quot;</span>
1685:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.desc\n        #{fd}\n    end\n&quot;</span>
1686: 
1687:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'UnderlinePosition'</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span>
1688:         <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'UnderlinePosition'</span>] = <span class="ruby-value">-100</span>
1689:     <span class="ruby-keyword kw">end</span>
1690: 
1691:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'UnderlineThickness'</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span>
1692:         <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'UnderlineThickness'</span>] = <span class="ruby-value">50</span>
1693:     <span class="ruby-keyword kw">end</span>
1694: 
1695:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.up\n        #{fm['UnderlinePosition']}\n    end\n&quot;</span>
1696:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.ut\n        #{fm['UnderlineThickness']}\n    end\n&quot;</span>
1697: 
1698:     <span class="ruby-identifier">w</span> = <span class="ruby-constant">MakeWidthArray</span>(<span class="ruby-identifier">fm</span>)
1699:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.cw\n#{w}\n    end\n&quot;</span>
1700: 
1701:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.enc\n        '#{enc}'\n    end\n&quot;</span>
1702:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.diff\n        #{(diff == nil) || (diff == '') ? 'nil' : '\'' + diff + '\''}\n    end\n&quot;</span>
1703: 
1704:     <span class="ruby-identifier">basename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">afmfile</span>, <span class="ruby-value str">'.*'</span>)
1705: 
1706:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fontfile</span> <span class="ruby-keyword kw">then</span>
1707:         <span class="ruby-comment cmt"># Embedded font</span>
1708:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">fontfile</span>) <span class="ruby-keyword kw">then</span>
1709:             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error: font file not found: #{fontfile}&quot;</span>
1710:         <span class="ruby-keyword kw">end</span>
1711: 
1712:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'TrueType'</span> <span class="ruby-keyword kw">then</span>
1713:             <span class="ruby-constant">CheckTTF</span>(<span class="ruby-identifier">fontfile</span>)
1714:         <span class="ruby-keyword kw">end</span>
1715: 
1716:         <span class="ruby-identifier">file</span> = <span class="ruby-value str">''</span>
1717:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">fontfile</span>, <span class="ruby-value str">'rb'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
1718:             <span class="ruby-identifier">file</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>()
1719:         <span class="ruby-keyword kw">end</span>
1720: 
1721:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Type1'</span> <span class="ruby-keyword kw">then</span>
1722:             <span class="ruby-comment cmt"># Find first two sections and discard third one</span>
1723:             <span class="ruby-identifier">header</span> = <span class="ruby-identifier">file</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">128</span>
1724:             <span class="ruby-identifier">file</span> = <span class="ruby-identifier">file</span>[<span class="ruby-value">6</span>, <span class="ruby-identifier">file</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">6</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header</span>
1725: 
1726:             <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'eexec'</span>)
1727:             <span class="ruby-identifier">raise</span> <span class="ruby-value str">'Error: font file does not seem to be valid Type1'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
1728: 
1729:             <span class="ruby-identifier">size1</span> = <span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">6</span>
1730: 
1731:             <span class="ruby-identifier">file</span> = <span class="ruby-identifier">file</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">size1</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">file</span>[<span class="ruby-identifier">size1</span> <span class="ruby-operator">+</span> <span class="ruby-value">6</span>, <span class="ruby-identifier">file</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">size1</span> <span class="ruby-operator">+</span> <span class="ruby-value">6</span>)] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">file</span>[<span class="ruby-identifier">size1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">128</span>
1732: 
1733:             <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'00000000'</span>)
1734:             <span class="ruby-identifier">raise</span> <span class="ruby-value str">'Error: font file does not seem to be valid Type1'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
1735: 
1736:             <span class="ruby-identifier">size2</span> = <span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">size1</span>
1737:             <span class="ruby-identifier">file</span> = <span class="ruby-identifier">file</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">size1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size2</span>]
1738:         <span class="ruby-keyword kw">end</span>
1739: 
1740:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">require</span> <span class="ruby-value str">'zlib'</span> <span class="ruby-keyword kw">then</span>
1741:             <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">basename</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'.z'</span>, <span class="ruby-value str">'wb'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflate</span>.<span class="ruby-identifier">deflate</span>(<span class="ruby-identifier">file</span>)) }
1742:             <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.file\n        '#{basename}.z'\n    end\n&quot;</span>
1743:             <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Font file compressed ('#{basename}.z')&quot;</span>
1744:         <span class="ruby-keyword kw">else</span>
1745:             <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.file\n        '#{File.basename(fontfile)}'\n    end\n&quot;</span>
1746:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">'Notice: font file could not be compressed (zlib not available)'</span>
1747:         <span class="ruby-keyword kw">end</span>
1748: 
1749:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Type1'</span> <span class="ruby-keyword kw">then</span>
1750:             <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.size1\n        '#{size1}'\n    end\n&quot;</span>
1751:             <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.size2\n        '#{size2}'\n    end\n&quot;</span>
1752:         <span class="ruby-keyword kw">else</span>
1753:             <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    def FontDef.originalsize\n        '#{File.size(fontfile)}'\n    end\n&quot;</span>
1754:         <span class="ruby-keyword kw">end</span>
1755: 
1756:     <span class="ruby-keyword kw">else</span>
1757:         <span class="ruby-comment cmt"># Not embedded font</span>
1758:         <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;    def FontDef.file\n        ''\n    end\n&quot;</span>
1759:     <span class="ruby-keyword kw">end</span>
1760: 
1761:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;end\n&quot;</span>
1762:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">basename</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'.rb'</span>, <span class="ruby-value str">'w'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">s</span>)}
1763:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Font definition file generated (#{basename}.rb)&quot;</span>
1764: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <a href="#M000002" class="method-signature">
          <span class="method-name">MakeFontDescriptor</span><span class="method-args">(fm, symbolic)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000002-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000002-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1472</span>
1472: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">MakeFontDescriptor</span>(<span class="ruby-identifier">fm</span>, <span class="ruby-identifier">symbolic</span>)
1473: 
1474:     <span class="ruby-comment cmt"># Ascent</span>
1475:     <span class="ruby-identifier">asc</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Ascender'</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Ascender'</span>] <span class="ruby-operator">:</span> <span class="ruby-value">1000</span>
1476:     <span class="ruby-identifier">fd</span> = <span class="ruby-node">&quot;{\n        'Ascent' =&gt; '#{asc}'&quot;</span>
1477: 
1478:     <span class="ruby-comment cmt"># Descent</span>
1479:     <span class="ruby-identifier">desc</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Descender'</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Descender'</span>] <span class="ruby-operator">:</span> <span class="ruby-value">-200</span>
1480:     <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;, 'Descent' =&gt; '#{desc}'&quot;</span>
1481: 
1482:     <span class="ruby-comment cmt"># CapHeight</span>
1483:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'CapHeight'</span>] <span class="ruby-keyword kw">then</span>
1484:         <span class="ruby-identifier">ch</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'CapHeight'</span>]
1485:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'CapXHeight'</span>]
1486:         <span class="ruby-identifier">ch</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'CapXHeight'</span>]
1487:     <span class="ruby-keyword kw">else</span>
1488:         <span class="ruby-identifier">ch</span> = <span class="ruby-identifier">asc</span>
1489:     <span class="ruby-keyword kw">end</span>
1490:     <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;, 'CapHeight' =&gt; '#{ch}'&quot;</span>
1491: 
1492:     <span class="ruby-comment cmt"># Flags</span>
1493:     <span class="ruby-identifier">flags</span> = <span class="ruby-value">0</span>
1494: 
1495:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'IsFixedPitch'</span>] <span class="ruby-keyword kw">then</span>
1496:         <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">0</span>
1497:     <span class="ruby-keyword kw">end</span>
1498: 
1499:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">symbolic</span> <span class="ruby-keyword kw">then</span>
1500:         <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">2</span>
1501:     <span class="ruby-keyword kw">else</span>
1502:         <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">5</span>
1503:     <span class="ruby-keyword kw">end</span>
1504: 
1505:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'ItalicAngle'</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">fm</span>[<span class="ruby-value str">'ItalicAngle'</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>) <span class="ruby-keyword kw">then</span>
1506:         <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">6</span>
1507:     <span class="ruby-keyword kw">end</span>
1508: 
1509:     <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;,\n        'Flags' =&gt; '#{flags}'&quot;</span>
1510: 
1511:     <span class="ruby-comment cmt"># FontBBox</span>
1512:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'FontBBox'</span>] <span class="ruby-keyword kw">then</span>
1513:         <span class="ruby-identifier">fbb</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'FontBBox'</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/,/</span>, <span class="ruby-value str">' '</span>)
1514:     <span class="ruby-keyword kw">else</span>
1515:         <span class="ruby-identifier">fbb</span> = <span class="ruby-node">&quot;[0 #{desc - 100} 1000 #{asc + 100}]&quot;</span>
1516:     <span class="ruby-keyword kw">end</span>
1517: 
1518:     <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;, 'FontBBox' =&gt; '#{fbb}'&quot;</span>
1519: 
1520:     <span class="ruby-comment cmt"># ItalicAngle</span>
1521:     <span class="ruby-identifier">ia</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'ItalicAngle'</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'ItalicAngle'</span>] <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
1522:     <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;,\n        'ItalicAngle' =&gt; '#{ia}'&quot;</span>
1523: 
1524:     <span class="ruby-comment cmt"># StemV</span>
1525:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'StdVW'</span>] <span class="ruby-keyword kw">then</span>
1526:         <span class="ruby-identifier">stemv</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'StdVW'</span>]
1527:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Weight'</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-regexp re">/bold|black/i</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Weight'</span>])
1528:         <span class="ruby-identifier">stemv</span> = <span class="ruby-value">120</span>
1529:     <span class="ruby-keyword kw">else</span>
1530:         <span class="ruby-identifier">stemv</span> = <span class="ruby-value">70</span>
1531:     <span class="ruby-keyword kw">end</span>
1532: 
1533:     <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;, 'StemV' =&gt; '#{stemv}'&quot;</span>
1534: 
1535:     <span class="ruby-comment cmt"># MissingWidth</span>
1536:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'MissingWidth'</span>] <span class="ruby-keyword kw">then</span>
1537:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;, 'MissingWidth' =&gt; '#{fm['MissingWidth']}'&quot;</span>
1538:     <span class="ruby-keyword kw">end</span>
1539: 
1540:     <span class="ruby-identifier">fd</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\n        }&quot;</span>
1541:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">fd</span>
1542: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">
          <a href="#M000004" class="method-signature">
          <span class="method-name">MakeFontEncoding</span><span class="method-args">(map)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000004-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000004-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1562</span>
1562: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">MakeFontEncoding</span>(<span class="ruby-identifier">map</span>)
1563: 
1564:     <span class="ruby-comment cmt"># Build differences from reference encoding</span>
1565:     <span class="ruby-identifier">ref</span> = <span class="ruby-constant">Charencodings</span>[<span class="ruby-value str">'cp1252'</span>]
1566:     <span class="ruby-identifier">s</span> = <span class="ruby-value str">''</span>
1567:     <span class="ruby-identifier">last</span> = <span class="ruby-value">0</span>
1568:     <span class="ruby-value">32</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">255</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
1569:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">ref</span>[<span class="ruby-identifier">i</span>] <span class="ruby-keyword kw">then</span>
1570:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">last</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">then</span>
1571:                 <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">' '</span>
1572:             <span class="ruby-keyword kw">end</span>
1573:             <span class="ruby-identifier">last</span> = <span class="ruby-identifier">i</span>
1574:             <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'/'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">' '</span>
1575:         <span class="ruby-keyword kw">end</span>
1576:     <span class="ruby-keyword kw">end</span>
1577:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">rstrip</span>
1578: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="#M000003" class="method-signature">
          <span class="method-name">MakeWidthArray</span><span class="method-args">(fm)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1544</span>
1544: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">MakeWidthArray</span>(<span class="ruby-identifier">fm</span>)
1545: 
1546:     <span class="ruby-comment cmt"># Make character width array</span>
1547:     <span class="ruby-identifier">s</span> = <span class="ruby-value str">&quot;        [\n        &quot;</span>
1548: 
1549:     <span class="ruby-identifier">cw</span> = <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Widths'</span>]
1550: 
1551:     <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">255</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
1552:         <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;%5d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">cw</span>[<span class="ruby-identifier">i</span>]
1553:         <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;,&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">!=</span> <span class="ruby-value">255</span>
1554:         <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\n        &quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">i</span> <span class="ruby-operator">%</span> <span class="ruby-value">8</span>) <span class="ruby-operator">==</span> <span class="ruby-value">7</span>
1555:     <span class="ruby-keyword kw">end</span>
1556: 
1557:     <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">']'</span>
1558: 
1559:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">s</span>
1560: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000001" class="method-detail">
        <a name="M000001"></a>

        <div class="method-heading">
          <a href="#M000001" class="method-signature">
          <span class="method-name">ReadAFM</span><span class="method-args">(file, map)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000001-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000001-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1354</span>
1354: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">ReadAFM</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">map</span>)
1355: 
1356:     <span class="ruby-comment cmt"># Read a font metric file</span>
1357:     <span class="ruby-identifier">a</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-identifier">file</span>)
1358: 
1359:     <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;File no found: #{file}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
1360: 
1361:     <span class="ruby-identifier">widths</span> = {}
1362:     <span class="ruby-identifier">fm</span> = {}
1363:     <span class="ruby-identifier">fix</span> = { <span class="ruby-value str">'Edot'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Edotaccent'</span>, <span class="ruby-value str">'edot'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'edotaccent'</span>,
1364:             <span class="ruby-value str">'Idot'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Idotaccent'</span>,
1365:             <span class="ruby-value str">'Zdot'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Zdotaccent'</span>, <span class="ruby-value str">'zdot'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'zdotaccent'</span>,
1366:             <span class="ruby-value str">'Odblacute'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Ohungarumlaut'</span>, <span class="ruby-value str">'odblacute'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'ohungarumlaut'</span>,
1367:             <span class="ruby-value str">'Udblacute'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Uhungarumlaut'</span>, <span class="ruby-value str">'udblacute'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'uhungarumlaut'</span>,
1368:             <span class="ruby-value str">'Gcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Gcommaaccent'</span>, <span class="ruby-value str">'gcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'gcommaaccent'</span>,
1369:             <span class="ruby-value str">'Kcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Kcommaaccent'</span>, <span class="ruby-value str">'kcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'kcommaaccent'</span>,
1370:             <span class="ruby-value str">'Lcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Lcommaaccent'</span>, <span class="ruby-value str">'lcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'lcommaaccent'</span>,
1371:             <span class="ruby-value str">'Ncedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Ncommaaccent'</span>, <span class="ruby-value str">'ncedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'ncommaaccent'</span>,
1372:             <span class="ruby-value str">'Rcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Rcommaaccent'</span>, <span class="ruby-value str">'rcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rcommaaccent'</span>,
1373:             <span class="ruby-value str">'Scedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Scommaaccent'</span>,<span class="ruby-value str">' scedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'scommaaccent'</span>,
1374:             <span class="ruby-value str">'Tcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Tcommaaccent'</span>,<span class="ruby-value str">' tcedilla'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'tcommaaccent'</span>,
1375:             <span class="ruby-value str">'Dslash'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Dcroat'</span>, <span class="ruby-value str">'dslash'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'dcroat'</span>,
1376:             <span class="ruby-value str">'Dmacron'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Dcroat'</span>, <span class="ruby-value str">'dmacron'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'dcroat'</span>,
1377:             <span class="ruby-value str">'combininggraveaccent'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'gravecomb'</span>,
1378:             <span class="ruby-value str">'combininghookabove'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'hookabovecomb'</span>,
1379:             <span class="ruby-value str">'combiningtildeaccent'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'tildecomb'</span>,
1380:             <span class="ruby-value str">'combiningacuteaccent'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'acutecomb'</span>,
1381:             <span class="ruby-value str">'combiningdotbelow'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'dotbelowcomb'</span>,
1382:             <span class="ruby-value str">'dongsign'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'dong'</span>
1383:         }
1384: 
1385:     <span class="ruby-identifier">a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
1386: 
1387:         <span class="ruby-identifier">e</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">rstrip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">' '</span>)
1388:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span>
1389: 
1390:         <span class="ruby-identifier">code</span>  = <span class="ruby-identifier">e</span>[<span class="ruby-value">0</span>]
1391:         <span class="ruby-identifier">param</span> = <span class="ruby-identifier">e</span>[<span class="ruby-value">1</span>]
1392: 
1393:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'C'</span> <span class="ruby-keyword kw">then</span>
1394: 
1395:             <span class="ruby-comment cmt"># Character metrics</span>
1396:             <span class="ruby-identifier">cc</span> = <span class="ruby-identifier">e</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
1397:             <span class="ruby-identifier">w</span>  = <span class="ruby-identifier">e</span>[<span class="ruby-value">4</span>]
1398:             <span class="ruby-identifier">gn</span> = <span class="ruby-identifier">e</span>[<span class="ruby-value">7</span>]
1399: 
1400:             <span class="ruby-identifier">gn</span> = <span class="ruby-value str">'Euro'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gn</span>[<span class="ruby-value">-4</span>, <span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'20AC'</span>
1401: 
1402:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fix</span>[<span class="ruby-identifier">gn</span>] <span class="ruby-keyword kw">then</span>
1403: 
1404:                 <span class="ruby-comment cmt"># Fix incorrect glyph name</span>
1405:                 <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-identifier">map</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
1406:                     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">fix</span>[<span class="ruby-identifier">gn</span>] <span class="ruby-keyword kw">then</span>
1407:                         <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">gn</span>
1408:                     <span class="ruby-keyword kw">end</span>
1409:                 <span class="ruby-keyword kw">end</span>
1410:             <span class="ruby-keyword kw">end</span>
1411: 
1412:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span>
1413:                 <span class="ruby-comment cmt"># Symbolic font: use built-in encoding</span>
1414:                 <span class="ruby-identifier">widths</span>[<span class="ruby-identifier">cc</span>] = <span class="ruby-identifier">w</span>
1415:             <span class="ruby-keyword kw">else</span>
1416:                 <span class="ruby-identifier">widths</span>[<span class="ruby-identifier">gn</span>] = <span class="ruby-identifier">w</span>
1417:                 <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'CapXHeight'</span>] = <span class="ruby-identifier">e</span>[<span class="ruby-value">13</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gn</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'X'</span>
1418:             <span class="ruby-keyword kw">end</span>
1419: 
1420:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'MissingWidth'</span>] = <span class="ruby-identifier">w</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gn</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'.notdef'</span>
1421: 
1422:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'FontName'</span> <span class="ruby-keyword kw">then</span>
1423:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'FontName'</span>] = <span class="ruby-identifier">param</span>
1424:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Weight'</span> <span class="ruby-keyword kw">then</span>
1425:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Weight'</span>] = <span class="ruby-identifier">param</span>
1426:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ItalicAngle'</span> <span class="ruby-keyword kw">then</span>
1427:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'ItalicAngle'</span>] = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">to_f</span>
1428:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Ascender'</span> <span class="ruby-keyword kw">then</span>
1429:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Ascender'</span>] = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">to_i</span>
1430:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Descender'</span> <span class="ruby-keyword kw">then</span>
1431:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Descender'</span>] = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">to_i</span>
1432:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'UnderlineThickness'</span> <span class="ruby-keyword kw">then</span>
1433:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'UnderlineThickness'</span>] = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">to_i</span>
1434:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'UnderlinePosition'</span> <span class="ruby-keyword kw">then</span>
1435:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'UnderlinePosition'</span>] = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">to_i</span>
1436:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'IsFixedPitch'</span> <span class="ruby-keyword kw">then</span>
1437:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'IsFixedPitch'</span>] = (<span class="ruby-identifier">param</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'true'</span>)
1438:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'FontBBox'</span> <span class="ruby-keyword kw">then</span>
1439:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'FontBBox'</span>] = <span class="ruby-node">&quot;[#{e[1]},#{e[2]},#{e[3]},#{e[4]}]&quot;</span>
1440:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'CapHeight'</span> <span class="ruby-keyword kw">then</span>
1441:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'CapHeight'</span>] = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">to_i</span>
1442:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'StdVW'</span> <span class="ruby-keyword kw">then</span>
1443:             <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'StdVW'</span>] = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">to_i</span>
1444:         <span class="ruby-keyword kw">end</span>
1445:     <span class="ruby-keyword kw">end</span>
1446: 
1447:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">'FontName not found'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'FontName'</span>]
1448: 
1449:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span>
1450:         <span class="ruby-identifier">widths</span>[<span class="ruby-value str">'.notdef'</span>] = <span class="ruby-value">600</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">widths</span>[<span class="ruby-value str">'.notdef'</span>]
1451: 
1452:         <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">widths</span>[<span class="ruby-value str">'Delta'</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">widths</span>[<span class="ruby-value str">'increment'</span>] <span class="ruby-keyword kw">then</span>
1453:             <span class="ruby-identifier">widths</span>[<span class="ruby-value str">'Delta'</span>] = <span class="ruby-identifier">widths</span>[<span class="ruby-value str">'increment'</span>]
1454:         <span class="ruby-keyword kw">end</span>
1455: 
1456:         <span class="ruby-comment cmt"># Order widths according to map</span>
1457:         <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">255</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
1458:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">widths</span>[<span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>]] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
1459:                 <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Warning: character #{map[i]} is missing&quot;</span>
1460:                 <span class="ruby-identifier">widths</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">widths</span>[<span class="ruby-value str">'.notdef'</span>]
1461:             <span class="ruby-keyword kw">else</span>
1462:                 <span class="ruby-identifier">widths</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">widths</span>[<span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>]]
1463:             <span class="ruby-keyword kw">end</span>
1464:         <span class="ruby-keyword kw">end</span>
1465:     <span class="ruby-keyword kw">end</span>
1466: 
1467:     <span class="ruby-identifier">fm</span>[<span class="ruby-value str">'Widths'</span>] = <span class="ruby-identifier">widths</span>
1468: 
1469:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">fm</span>
1470: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">ReadLong</span><span class="method-args">(f)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1585</span>
1585: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">ReadLong</span>(<span class="ruby-identifier">f</span>)
1586:     <span class="ruby-identifier">a</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">4</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'N'</span>)
1587:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>]
1588: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="#M000005" class="method-signature">
          <span class="method-name">ReadShort</span><span class="method-args">(f)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
      <span class="ruby-comment cmt"># File vendor/plugins/active_fpdf/lib/makefont.rb, line 1580</span>
1580: <span class="ruby-keyword kw">def</span> <span class="ruby-constant">ReadShort</span>(<span class="ruby-identifier">f</span>)
1581:     <span class="ruby-identifier">a</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'n'</span>)
1582:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>]
1583: <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>